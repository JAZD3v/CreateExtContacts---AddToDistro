# This was written with with the requirement of importing the content from a remote device off the "Local", Azure Virtual Desktop device.
# You can change the name of the file and the folder to whatever fits your needs.  
Write-host “PLEASE ENSURE THERE IS A FOLDER NAMED 'CSV_Imports' CREATED ON THE DESKTOP OF YOUR ONEDRIVE WITH A CSV FILE NAMED '1 - CreateContactAddToDistro_FromCsv_V1.2.csv' BEFORE RUNNING THIS. IF YOU HAVEN’T AL
READY CREATED IT PRESS 'Ctrl C' TO CANCEL AND CREATED IT” -backgroundColor Red

$ComputerName=Read-host "Type NUMBER PORTION of your COMPUTER NAME"
$UserName=Read-host "Type Your USER NAME"

# If you have a prefix for all your computer names in your domain, you can add that to the string before your $ComputerName.
# You are free to change the file path to what ever fits your organization.  
$Items= Import-Csv "\\hqhq-uw-$ComputerName\c$\Users\$UserName\OneDrive - Federal Bureau of Investigation\Desktop\CSV_Imports\1 - CreateContactAddToDistro_FromCsv_V1.2.csv"
$Distro=$Items[0].DistroName
$Item=Get-DistributionGroup $Distro

# The $OU variable below is from the Distribution group.
# This Orgs Organizational Unit hierarchy would place the differnt object types (i.e. Distribution GROUPS) by department/division.
# This command parses out the Group from the DistinguishedName property of the Distribution group and replaces it with "CONTACTS".
$OU=(($Item.DistinguishedName).remove(0,(($Item.DistinguishedName).IndexOf(",")+1))).replace("GROUPS","CONTACTS")

<#
****************************************************************************************************
**  For Field Offices: $OU=OU=xxHQ,OU=CONTACTS,OU=Users And Groups,OU=UNET,DC=FBI,DC=GOV"         **
**  For Headquaters: $OU=OU=DIVxx,OU=HQHQ,OU=CONTACTS,OU=Users And Groups,OU=UNET,DC=FBI,DC=GOV   **
**                                                                                                **
**          ENSURE TO REPLACE THE "xx" with the infor for the OU the requester is in              **
****************************************************************************************************
#>

Import-Csv "\\hqhq-uw-$ComputerName\c$\Users\$UserName\OneDrive - Federal Bureau of Investigation\Desktop\CSV_Imports\1 - CreateContactAddToDistro_FromCsv_V1.2.csv"  | foreach {
new-mailcontact -ExternalEmailAddress "SMTP:$($_.Email)" -DisplayName $($($_.LastName)+", "+$($_.FirstName)) -LastName $($_.LastName) -Name $($_.LastName), $($_.FirstName) -firstName $($_.FirstName) -Alias $((($($_.FirstName)+"."+$($_.LastName))).replace(" ","-")) -OrganizationalUnit $OU | out-null
write-host "Contact $($_.Email) created:" -BackgroundColor DarkGreen
Add-DistributionGroupMember -identity $Distro -Member $_.Email -BypassSecurityGroupManagerCheck
Start-Sleep -Seconds 2
Get-MailContact $($_.Email) | fl DisplayName,ExternalEmailAddress,Identity,alias
}

Import-Csv "\\hqhq-uw-$ComputerName\c$\Users\$UserName\OneDrive - Federal Bureau of Investigation\Desktop\CSV_Imports\1 - CreateContactAddToDistro_FromCsv_V1.2.csv" | foreach {
$Contact=$_.Email
write-host "Contact $($Contact) added to Distro:" -BackgroundColor DarkGreen
Get-DistributionGroupMember $Distro | ?{$_.PrimarySmtpAddress -eq $($Contact)} | fl Alias,PrimarySmtpAddress,@{n="DistroGroup";e={$Distro}}
}